<!DOCTYPE html>
<html ng-app="AngujarJS" ng-controller="Plato">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>SmartLunch</title>
    <meta name="description" content="SmartLunch">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- CSS Externo -->
    <link rel="stylesheet" href="vendor/bootstrap/bootstrap.min.css">
    <link rel="stylesheet" href="vendor/select2/select2.min.css">
    <link rel="stylesheet" href="vendor/owlcarousel/owl.carousel.min.css">
    <link rel="stylesheet" href="https://cdn.rawgit.com/noelboss/featherlight/1.7.13/release/featherlight.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tempusdominus-bootstrap-4/5.0.1/css/tempusdominus-bootstrap-4.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.8.1/css/brands.css">
    <!-- Fuentes -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,700|Josefin+Sans:300,400,700">
    <link rel="stylesheet" href="https://cdn.linearicons.com/free/1.0.0/icon-font.min.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" crossorigin="anonymous">
    <!-- CSS Personalizado -->
    <link rel="stylesheet" href="css/style.min.css">
    <link rel="stylesheet" href="css/smartstyle.css">

    <!-- SweetAlert2 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" rel="stylesheet">

    <!-- Modernizr -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.js"></script>

    <style>
        .breadcrumb {
            border-radius: 0;
        }

        .breadcrumb-container {
            margin-top: 0px;
        }

        /* Botón de confirmación/cancelación en Swal */
        .swal2-confirm {
            background-color: #495057 !important;
            border-color: #495057 !important;
            color: white !important;
        }

            .swal2-confirm:hover {
                background-color: #343a40 !important;
                border-color: #343a40 !important;
            }

        .swal2-cancel {
            background-color: #dc3545 !important;
            border-color: #dc3545 !important;
            color: white !important;
        }

            .swal2-cancel:hover {
                background-color: #c82333 !important;
                border-color: #c82333 !important;
            }
        /* .swal2-container { z-index: 20000 !important; }  opcional si algo la tapa */

        /* Estilos para botones de paginación personalizados */
        .pagination-container {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .pagination-buttons {
            display: flex;
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 4px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .pagination-btn {
            background-color: #ffffff;
            border: none;
            border-radius: 6px;
            padding: 8px 12px;
            margin: 0 2px;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            color: #6c757d;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 40px;
            height: 36px;
        }

        .pagination-btn:hover:not(:disabled) {
            background-color: #e9ecef;
            color: #495057;
            transform: translateY(-1px);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
        }

        .pagination-btn:active:not(:disabled) {
            transform: translateY(0);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .pagination-btn:disabled {
            background-color: #f8f9fa;
            color: #adb5bd;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .pagination-btn i {
            font-size: 12px;
        }

        /* Estilos para el botón de limpiar búsqueda */
        .input-group-append .btn {
            border-left: 0;
            border-top-left-radius: 0;
            border-bottom-left-radius: 0;
            background-color: #5c636a !important;
            border-color: #5c636a !important;
            color: white !important;
        }

        .input-group-append .btn:hover:not(:disabled) {
            background-color: #5c636a !important;
            border-color: #5c636a !important;
            color: white !important;
        }

        .input-group-append .btn:focus {
            background-color: #5c636a !important;
            border-color: #5c636a !important;
            color: white !important;
            box-shadow: none !important;
        }

        .input-group-append .btn:disabled {
            background-color: #f8f9fa;
            border-color: #dee2e6;
            color: #6c757d;
            cursor: not-allowed;
        }

        /* Estilos para el botón Agregar */
        .btn-primary[ng-click="ViewCreate()"] {
            background-color: #5c636a !important;
            border-color: #5c636a !important;
            color: white !important;
            border: none !important;
            border-radius: 6px !important;
        }

        .btn-primary[ng-click="ViewCreate()"]:hover {
            background-color: #5c636a !important;
            border-color: #5c636a !important;
            color: white !important;
        }

        .btn-primary[ng-click="ViewCreate()"]:focus {
            background-color: #5c636a !important;
            border-color: #5c636a !important;
            color: white !important;
            box-shadow: none !important;
        }

        /* Estilos para botones de acciones */
        .action-btn {
            width: 32px !important;
            height: 32px !important;
            border-radius: 6px !important;
            border: none !important;
            display: inline-flex !important;
            align-items: center !important;
            justify-content: center !important;
            padding: 0 !important;
            margin: 0 2px !important;
        }

        .edit-btn {
            background-color: #343a40 !important;
            color: white !important;
        }

        .edit-btn:hover {
            background-color: #343a40 !important;
            color: white !important;
        }

        .edit-btn:focus {
            background-color: #343a40 !important;
            color: white !important;
            box-shadow: none !important;
        }

        .delete-btn {
            background-color: #dc3545 !important;
            color: white !important;
        }

        .delete-btn:hover {
            background-color: #dc3545 !important;
            color: white !important;
        }

        .delete-btn:focus {
            background-color: #dc3545 !important;
            color: white !important;
            box-shadow: none !important;
        }

        /* Estilos para botones Guardar y Cancelar */
        .save-btn {
            background-color: #36393F !important;
            border-color: #36393F !important;
            color: white !important;
            border-radius: 6px !important;
            border: none !important;
            padding: 8px 16px !important;
            margin-right: 10px !important;
        }

        .save-btn:hover {
            background-color: #36393F !important;
            border-color: #36393F !important;
            color: white !important;
        }

        .save-btn:focus {
            background-color: #36393F !important;
            border-color: #36393F !important;
            color: white !important;
            box-shadow: none !important;
        }

        .cancel-btn {
            background-color: #F04747 !important;
            border-color: #F04747 !important;
            color: white !important;
            border-radius: 6px !important;
            border: none !important;
            padding: 8px 16px !important;
        }

        .cancel-btn:hover {
            background-color: #F04747 !important;
            border-color: #F04747 !important;
            color: white !important;
        }

        .cancel-btn:focus {
            background-color: #F04747 !important;
            border-color: #F04747 !important;
            color: white !important;
            box-shadow: none !important;
        }

        /* Estilos para breadcrumb */
        .breadcrumb {
            border-radius: 0;
        }

        .breadcrumb-container {
            margin-top: 0px;
        }
        
        /* Estilos para que el fondo blanco llegue hasta el final */
        html, body {
            height: 100%;
        }
        
        body {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .container-fluid {
            flex: 1;
        }
        
        .solid-background {
            min-height: calc(100vh - 60px);
            background-color: #ffffff;
        }
        
        .smart-bg {
            margin-top: auto;
        }
    </style>
</head>

<body data-spy="scroll" data-target="#navbar" class="static-layout">
    <div class="container-fluid" style="margin-top: 0 !important;">
        <div class="solid-background">
            <!-- Menu -->
            <div ng-include="'navbar.html'"></div>

            <!-- Titulo -->
            <div class="heading-section bg-dark text-white pt-2 pl-3">
                <div class="row align-items-center">
                    <div class="col-md-8">
                        <h3 class="mb-0">Gestión de platos</h3>
                    </div>
                    <div class="col-md-4">
                        <nav aria-label="breadcrumb" ng-if="ViewAction !== 'Platos'">
                            <ol class="breadcrumb mb-0 bg-transparent text-white" style="font-size: 0.9em;">
                                <li class="breadcrumb-item">
                                    <a href="#" ng-click="ViewAction = 'Platos'; ModelReadAll()" class="text-white-50" style="text-decoration: none;">
                                        <i class="fa fa-home mr-1"></i>Gestión de platos
                                    </a>
                                </li>
                                <li class="breadcrumb-item active text-white" aria-current="page">
                                    <span ng-if="ViewAction === 'Nuevo Plato'">
                                        <i class="fa fa-plus mr-1"></i>Nuevo
                                    </span>
                                    <span ng-if="ViewAction === 'Editar Plato'">
                                        <i class="fa fa-edit mr-1"></i>Editar
                                    </span>
                                </li>
                            </ol>
                        </nav>
                    </div>
                </div>
            </div>

            <!-- Contenido principal -->
            <div class="container-fluid" style="margin-top: 0 !important;">

                <!-- Botón de agregar -->
                <div class="dishes-text row mb-2" ng-show="ViewAction !== 'Nuevo Plato' && ViewAction !== 'Editar Plato'">
                    <div class="col text-right">
                        <button type="button" class="btn btn-primary mb-2 mr-3"
                                ng-click="ViewCreate()"
                                style="background-color: #5c636a; border-color: #5c636a; color: white; padding: 0.5rem 1rem; cursor: pointer; border-radius: 6px; border: none;">
                            <i class="fa fa-plus text-white" style="font-size:14px; margin-right: 5px;"></i> Agregar
                        </button>
                    </div>
                </div>

                <!-- Buscar -->
                <div class="row my-3">
                    <div class="col-md-12" ng-show="ViewAction !== 'Nuevo Plato' && ViewAction !== 'Editar Plato'">
                        <label for="buscarPlato">Buscar</label>
                        <div class="input-group">
                            <input type="text" class="form-control" ng-model="searchText"
                                   id="buscarPlato" title="Buscar platos"
                                   placeholder="Código, descripción, ingredientes, plan nutricional, costo">
                            <div class="input-group-append">
                                <button type="button" class="btn btn-outline-secondary" title="Limpiar" ng-click="searchText=''">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>


                <hr ng-show="ViewAction !== 'Nuevo Plato' && ViewAction !== 'Editar Plato'">

                <!-- Lista -->
                <div ng-if="ViewAction==='Platos'">
                    <div class="table-responsive">
                        <table class="table table-hover table-sm">
                            <thead style="font-size: 14px;">
                                <tr class="bg-dark text-white">
                                    <th ng-class="{'d-none d-md-table-cell': isMobile}">Código</th>
                                    <th>Descripción</th>
                                    <th class="d-none d-md-table-cell">Ingredientes</th>
                                    <th>Plan Nutricional</th>
                                    <th>Costo ($)</th>
                                    <th class="text-center">Acciones</th>
                                </tr>
                            </thead>
                            <tbody ng-if="(filteredData || dataset).length > 0">
                                <tr ng-repeat="item in (filteredData || dataset) | filter:searchText | startFrom:currentPage*pageSize | limitTo:pageSize">
                                    <td ng-class="{'d-none d-md-table-cell': isMobile}">{{item.codigo}}</td>
                                    <td>{{item.descripcion}}</td>
                                    <td class="d-none d-md-table-cell">{{item.ingredientes}}</td>
                                    <td>{{item.plannutricional}}</td>
                                    <td>${{ item.costo | number:2 }}</td>
                                    <td class="text-center">
                                        <button type="button" class="btn btn-link p-0 action-btn edit-btn" title="Editar plato"
                                                ng-click="ViewUpdate(item.id)">
                                            <i class="fa fa-edit"></i>
                                        </button>
                                        <button type="button" class="btn btn-link p-0 ml-2 action-btn delete-btn" title="Eliminar plato"
                                                ng-click="ViewDelete(item.id, $event)">
                                            <i class="fa fa-trash"></i>
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                            <tr ng-if="(filteredData || dataset).length === 0">
                                <td colspan="6" class="text-center">No se encontraron resultados.</td>
                            </tr>
                        </table>
                    </div>

                    <!-- Paginación -->
                    <div class="pagination-container mt-3">
                        <div class="pagination-buttons">
                            <button class="pagination-btn prev-btn" 
                                    ng-disabled="currentPage == 0" 
                                    ng-click="currentPage = currentPage - 1" 
                                    title="Página anterior">
                                <i class="fa fa-angle-double-left"></i>
                            </button>
                            <button class="pagination-btn next-btn" 
                                    ng-disabled="currentPage + 1 >= totalPages" 
                                    ng-click="currentPage = currentPage + 1" 
                                    title="Página siguiente">
                                <i class="fa fa-angle-double-right"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Form Nuevo/Editar -->
                <div ng-if="ViewAction==='Nuevo Plato' || ViewAction==='Editar Plato'">
                    <div class="container-fluid">
                        <div class="alert alert-info mb-3" role="alert" ng-if="ViewAction==='Nuevo Plato'">
                            <i class="fa fa-info-circle mr-2"></i>
                            <strong>Creando nuevo plato</strong> - Complete los campos obligatorios para guardar.
                        </div>
                        <div class="alert alert-info mb-3" role="alert" ng-if="ViewAction==='Editar Plato'">
                            <i class="fa fa-info-circle mr-2"></i>
                            <strong>Editando plato</strong> - Complete los campos obligatorios para guardar.
                        </div>
                        <div class="dishes-text col-12" style="margin-top: -20px !important;">
                            <form class="form-group row" name="platoForm"
                          ng-submit="ViewAction==='Nuevo Plato' ? ModelCreate(platoForm.$valid) : ModelUpdate(platoForm.$valid, view_id)"
                          novalidate>
                                <div class="col-6" style="padding-left: 0px; padding-right:8px !important">
                                    <div class="pb-3 form-group" style="margin-top: 20px !important;">
                                        <label for="codigo"><span class="text-danger">*</span> Código</label>
                                        <input ng-pattern="/^[a-zA-Z0-9._%+-]*$/"
                                               ng-minlength="1" ng-maxlength="20"
                                               class="col-8 form-control" type="text" id="codigo" name="codigo"
                                               ng-model="plato.codigo" placeholder="Ingrese código" required>
                                        <span ng-show="(!plato.codigo || plato.codigo.trim() === '') && showValidationErrors" class="text-danger">Campo Código requerido</span>
                                    </div>

                                    <div class="pb-3 form-group">
                                        <label for="descripcion"><span class="text-danger">*</span> Descripción</label>
                                        <input ng-pattern="/^[a-zA-Z0-9ÁÉÍÓÚáéíóúñ.,_ %+-]*$/"
                                               ng-minlength="2" ng-maxlength="140"
                                               class="col-8 form-control" type="text" id="descripcion" name="descripcion"
                                               ng-model="plato.descripcion" placeholder="Ingrese descripción" required>
                                        <span ng-show="(!plato.descripcion || plato.descripcion.trim() === '') && showValidationErrors" class="text-danger">Campo Descripción requerido</span>
                                    </div>

                                    <div class="pb-3 form-group">
                                        <label for="ingredientes"><span class="text-danger">*</span> Ingredientes</label>
                                        <input ng-pattern="/^[a-zA-Z0-9ÁÉÍÓÚáéíóúñ.,_ %+-]*$/"
                                               ng-minlength="2" ng-maxlength="140"
                                               class="col-8 form-control" type="text" id="ingredientes" name="ingredientes"
                                               ng-model="plato.ingredientes" placeholder="Ingrese ingredientes" required>
                                        <span ng-show="(!plato.ingredientes || plato.ingredientes.trim() === '') && showValidationErrors" class="text-danger">Campo Ingredientes requerido</span>
                                    </div>

                                    <div class="pb-3 form-group">
                                        <label for="plannutricional"><span class="text-danger">*</span> Plan Nutricional</label>
                                        <select class="col-8 form-control" id="plannutricional" name="plannutricional"
                                                ng-model="plato.plannutricional" required>
                                            <option ng-repeat="x in planes | orderBy:'nombre'" value="{{x.nombre}}">{{x.nombre}}</option>
                                        </select>
                                        <span ng-show="(!plato.plannutricional || plato.plannutricional.trim() === '') && showValidationErrors" class="text-danger">Campo Plan Nutricional requerido</span>
                                    </div>
                                </div>

                                <div class="col-6" style="padding-left: 0px; padding-right:0px !important">
                                    <!-- Sección de imagen -->
                                    <div class="pb-3 form-group" style="margin-top: 20px !important;">
                                        <label for="imagen">Imagen del plato</label>
                                        <div class="card">
                                            <div class="card-body text-center">
                                                <img class="img-fluid mb-3" ng-if="view_previewImage" ng-src="{{view_previewImage}}" alt="Imagen del plato" style="max-height: 120px; max-width: 120px;" />
                                                <input class="form-control-file" accept="image/jpeg,image/png,image/jpg" type="file"
                                                       onchange="angular.element(this).scope().loadImage()" id="view_file"
                                                       ng-model="view_file" />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="pb-3 form-group" style="margin-top: 40px !important;">
                                        <label for="costo">Costo ($)</label>
                                        <input class="col-8 form-control" type="number" id="costo" name="costo"
                                               ng-model="plato.costo" placeholder="0.00" min="0" step="0.01"
                                               onkeypress="return (event.charCode >= 48 && event.charCode <= 57) || event.charCode === 46 || event.charCode === 8 || event.charCode === 9 || event.charCode === 13">
                                        <span ng-show="plato.costo < 0" class="text-danger">El costo no puede ser negativo</span>
                                    </div>
                                </div>

                                <div class="col-6" style="padding-left: 0px; padding-right:0px !important">
                                    <!-- Espacio vacío para mantener alineación -->
                                </div>


                                <div class="col-12">
                                    <button type="submit" class="btn btn-primary mt-3" title="Guardar" 
                                            style="background-color: #36393F; border-color: #36393F; color: white; cursor: pointer; margin-right:8px; border-radius: 6px; padding: 8px 16px; font-weight: bold; box-shadow: 0 2px 4px rgba(0,0,0,0.2);">
                                        <i class="fa fa-save" style="margin-right: 6px;"></i>Guardar
                                    </button>
                                    <button type="button" class="btn btn-primary mt-3" ng-click="ViewCancel()" 
                                            style="background-color: #F04747; border-color: #F04747; color: white; cursor: pointer; border-radius: 6px; padding: 8px 16px; font-weight: bold; box-shadow: 0 2px 4px rgba(0,0,0,0.2);">
                                        <i class="fa fa-times" style="margin-right: 6px;"></i>Cancelar
                                    </button>
                                </div>

                        </div>
                            </form>
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <!-- Footer -->
        <div ng-include="'footer.html'"></div>
    </div>

    <!-- JS Externo -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js"></script>
    <script src="vendor/bootstrap/popper.min.js"></script>
    <script src="vendor/bootstrap/bootstrap.min.js"></script>
    <script src="vendor/select2/select2.min.js"></script>
    <script src="vendor/owlcarousel/owl.carousel.min.js"></script>
    <script src="https://cdn.rawgit.com/noelboss/featherlight/1.7.13/release/featherlight.min.js"></script>
    <script src="vendor/stellar/jquery.stellar.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tempusdominus-bootstrap-4/5.0.1/js/tempusdominus-bootstrap-4.min.js"></script>

    <!-- AngularJS y libs -->
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.7.9/angular.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.7.9/angular-messages.min.js"></script>

    <!-- SweetAlert2 v11 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.all.min.js"></script>

    <!-- Shim seguro: NO reescribe Swal, solo crea alias Swal.fire(...) -->
    <script>
        (function (w) {
            if (!w.Swal || typeof w.Swal.fire !== 'function') return;
            w.Swal.fire = function () {
                if (arguments.length === 1 && typeof arguments[0] === 'object') {
                    return w.Swal.fire(arguments[0]);
                }
                var args = Array.prototype.slice.call(arguments);
                var opt = {};
                if (args[0]) opt.title = args[0];
                if (args[1]) opt.text = args[1];
                if (args[2]) opt.icon = args[2];
                return w.Swal.fire(opt);
            };
        })(window);
    </script>

    <!-- App -->
    <script src="js/angular-base64.js"></script>
    <script src="js/navbar-direct.js"></script>
    <script src="js/plato.js"></script>
</body>
</html>
