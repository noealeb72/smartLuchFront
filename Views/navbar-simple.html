<nav class="navbar navbar-expand-lg navbar-dark smart-bg">
    <h4 class="navbar-brand smart-title"><i class="fa fa-utensils mr-2"></i>SmartLunch</h4>
    
    <!-- Información del usuario -->
    <div class="text-white small" id="user-info" style="margin-right: 10px; display: none;">
        <span id="user-name"></span>
        <span class="badge badge-light text-dark" id="user-role"></span>
    </div>

    <button class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
            aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav ml-auto text-right" id="navbar-menu">
            <!-- Los elementos del menú se cargarán dinámicamente -->
        </ul>
    </div>
</nav>

<script>
// Script para manejar el navbar de forma simple
(function() {
    'use strict';
    
    // Función para obtener el rol del usuario
    function getUserRole() {
        return localStorage.getItem('role') || '';
    }
    
    // Función para obtener el nombre del usuario
    function getUserName() {
        var nombre = localStorage.getItem('nombre') || '';
        var apellido = localStorage.getItem('apellido') || '';
        return (nombre + ' ' + apellido).trim();
    }
    
    // Función para mostrar información del usuario
    function showUserInfo() {
        var userInfo = document.getElementById('user-info');
        var userName = document.getElementById('user-name');
        var userRole = document.getElementById('user-role');
        
        if (userInfo && userName && userRole) {
            var name = getUserName();
            var role = getUserRole();
            
            console.log('Mostrando información del usuario:', {name: name, role: role});
            
            if (role) {
                userName.textContent = name;
                userRole.textContent = role;
                userInfo.style.display = 'block';
            } else {
                userInfo.style.display = 'none';
            }
        }
    }
    
    // Función para crear un elemento de menú
    function createMenuItem(text, href, icon, isDropdown) {
        var li = document.createElement('li');
        li.className = 'nav-item active';
        
        if (isDropdown) {
            var a = document.createElement('a');
            a.className = 'nav-link dropdown-toggle active';
            a.href = '#';
            a.setAttribute('role', 'button');
            a.setAttribute('data-toggle', 'dropdown');
            a.setAttribute('aria-haspopup', 'true');
            a.setAttribute('aria-expanded', 'false');
            a.innerHTML = '<i class="fa ' + icon + ' mr-1"></i> ' + text;
            
            var dropdownId = 'dd' + text.replace(/\s+/g, '');
            a.id = dropdownId;
            
            var div = document.createElement('div');
            div.className = 'dropdown-menu';
            div.setAttribute('aria-labelledby', dropdownId);
            
            li.appendChild(a);
            li.appendChild(div);
        } else {
            var a = document.createElement('a');
            a.className = 'nav-link';
            a.href = href;
            a.innerHTML = '<i class="fa ' + icon + ' mr-1"></i> ' + text;
            li.appendChild(a);
        }
        
        return li;
    }
    
    // Función para agregar elementos al dropdown
    function addDropdownItem(dropdown, text, href) {
        var a = document.createElement('a');
        a.className = 'dropdown-item';
        a.href = href;
        a.textContent = text;
        dropdown.appendChild(a);
    }
    
    // Función para cargar el menú según el rol
    function loadNavbarMenu() {
        var menuContainer = document.getElementById('navbar-menu');
        if (!menuContainer) {
            console.error('No se encontró el contenedor del menú');
            return;
        }
        
        // Limpiar menú existente
        menuContainer.innerHTML = '';
        
        var role = getUserRole();
        console.log('Cargando menú para rol:', role);
        
        // Menú común para todos los roles
        if (role !== 'Comensal') {
            var inicio = createMenuItem('Inicio', 'index.html', 'fa-home', false);
            menuContainer.appendChild(inicio);
        }
        
        // Menú específico por rol
        switch(role) {
            case 'Cocina':
                var despacho = createMenuItem('Despacho de plato', 'despacho.html', 'fa-edit', false);
                menuContainer.appendChild(despacho);
                
                var cocina = createMenuItem('Cocina', '#', 'fa-boxes', true);
                var cocinaDropdown = cocina.querySelector('.dropdown-menu');
                addDropdownItem(cocinaDropdown, 'Platos', 'plato.html');
                addDropdownItem(cocinaDropdown, 'Menu del Día', 'menudeldia.html');
                menuContainer.appendChild(cocina);
                break;
                
            case 'Gerencia':
                // Reportes de Gestión
                var reportes = createMenuItem('Reportes de Gestión', '#', 'fa-chart-bar', true);
                var reportesDropdown = reportes.querySelector('.dropdown-menu');
                addDropdownItem(reportesDropdown, 'Reporte por Comensal', 'reportegcomensales.html');
                addDropdownItem(reportesDropdown, 'Reporte de Gestión', 'reporteggestion.html');
                menuContainer.appendChild(reportes);
                
                // Gestión
                var gestion = createMenuItem('Gestión', '#', 'fa-users', true);
                var gestionDropdown = gestion.querySelector('.dropdown-menu');
                addDropdownItem(gestionDropdown, 'Usuarios', 'usuarios.html');
                addDropdownItem(gestionDropdown, 'Plantas', 'planta.html');
                addDropdownItem(gestionDropdown, 'Centros de Costo', 'centrodecosto.html');
                addDropdownItem(gestionDropdown, 'Proyectos', 'proyecto.html');
                addDropdownItem(gestionDropdown, 'Perfiles Nutricionales', 'plan-nutricional.html');
                addDropdownItem(gestionDropdown, 'Jerarquías', 'jerarquia.html');
                addDropdownItem(gestionDropdown, 'Turnos', 'turno.html');
                menuContainer.appendChild(gestion);
                break;
                
            case 'Admin':
                // Configuración para Admin
                var config = createMenuItem('Configuración', '#', 'fa-cog', true);
                var configDropdown = config.querySelector('.dropdown-menu');
                addDropdownItem(configDropdown, 'Usuarios', 'usuarios.html');
                addDropdownItem(configDropdown, 'Planta', 'planta.html');
                addDropdownItem(configDropdown, 'Centro de Costo', 'centrodecosto.html');
                addDropdownItem(configDropdown, 'Proyecto', 'proyecto.html');
                addDropdownItem(configDropdown, 'Perfil Nutricional', 'plan-nutricional.html');
                addDropdownItem(configDropdown, 'Jerarquia', 'jerarquia.html');
                addDropdownItem(configDropdown, 'Turnos', 'turno.html');
                menuContainer.appendChild(config);
                break;
        }
        
        // Botón de logout
        var logout = createMenuItem('', 'login.html', 'fa-sign-out-alt', false);
        menuContainer.appendChild(logout);
    }
    
    // Función para inicializar el navbar
    function initNavbar() {
        console.log('Inicializando navbar...');
        showUserInfo();
        loadNavbarMenu();
    }
    
    // Inicializar cuando el DOM esté listo
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initNavbar);
    } else {
        initNavbar();
    }
    
    // Hacer funciones disponibles globalmente
    window.loadNavbarMenu = loadNavbarMenu;
    window.showUserInfo = showUserInfo;
    window.getUserRole = getUserRole;
    window.initNavbar = initNavbar;
    
})();
</script>

