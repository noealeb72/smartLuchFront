<!DOCTYPE html>
<html lang="es" ng-app="AngujarJS">

<head>
    <meta charset="utf-8" />
    <title>Smart Lunch</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Bootstrap / Icons -->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
          crossorigin="anonymous" />
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.1/css/all.css"
          integrity="sha384-gfdkjb5BdAXd+lj+gudLWI+BXq4IuLW5IT+brZEZsLFm++aCMlF1V92rMkPaX4PP"
          crossorigin="anonymous" />

    <!-- Fonts -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,700|Josefin+Sans:300,400,700">

    <!-- Tus CSS -->
    <link rel="stylesheet" href="css/login.css" />
    <link rel="stylesheet" href="css/toast-fix.css" />
    <link rel="stylesheet" href="css/smartstyle.css" />

    <style>
        /* Layout base centrado con fondo mejorado */
        body {
            margin: 0;
            padding: 0;
            min-height: 100vh;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 50%, #f8f9fa 100%);
            background-attachment: fixed;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #212529;
            overflow-y: auto;
            position: relative;
        }
        
        /* Decoraciones de fondo sutiles */
        body::before {
            content: '';
            position: fixed;
            top: -50%;
            right: -10%;
            width: 500px;
            height: 500px;
            background: radial-gradient(circle, rgba(243, 73, 73, 0.08) 0%, transparent 70%);
            border-radius: 50%;
            z-index: 0;
        }
        
        body::after {
            content: '';
            position: fixed;
            bottom: -30%;
            left: -5%;
            width: 400px;
            height: 400px;
            background: radial-gradient(circle, rgba(243, 73, 73, 0.06) 0%, transparent 70%);
            border-radius: 50%;
            z-index: 0;
        }

        .user_card {
            background: #ffffff;
            border-radius: 16px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.12), 0 2px 8px rgba(0, 0, 0, 0.08);
            width: 100%;
            max-width: 450px;
            padding: 30px;
            padding-top: 120px;
            position: relative;
            z-index: 1;
            border: 1px solid rgba(243, 73, 73, 0.1);
        }

        .brand_logo_container {
            text-align: center;
            margin-bottom: 20px;
            position: absolute;
            height: 180px;
            width: 180px;
            top: -90px;
            left: 50%;
            transform: translateX(-50%);
            border-radius: 50%;
            background: linear-gradient(135deg, #F34949 0%, #E63939 100%);
            padding: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: 0 8px 25px rgba(243, 73, 73, 0.3), 0 4px 10px rgba(243, 73, 73, 0.2);
            border: 4px solid #ffffff;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .brand_logo_container:hover {
            transform: translateX(-50%) scale(1.05);
            box-shadow: 0 12px 35px rgba(243, 73, 73, 0.4), 0 6px 15px rgba(243, 73, 73, 0.3);
        }

            .brand_logo_container .login-logo {
                font-size: 3.5rem;
                color: white !important;
                margin-top: 15px;
                text-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            }
            
            .brand_logo_container h5 {
                margin-top: 8px;
                margin-bottom: 0;
                font-family: 'Josefin Sans', sans-serif;
                font-weight: 600;
                font-size: 1.1rem;
                letter-spacing: 0.5px;
                text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            }

        /* Mensaje de error en el form */
        .error-msg {
            display: block;
            margin-bottom: 1rem;
            color: #F34949;
            font-weight: 600;
            font-size: 0.875rem;
            padding: 0.75rem;
            background-color: rgba(243, 73, 73, 0.1);
            border-left: 3px solid #F34949;
            border-radius: 4px;
        }
        
        /* Título de bienvenida */
        .welcome-title {
            text-align: center;
            margin-bottom: 2rem;
            margin-top: 1rem;
        }
        
        .welcome-title h4 {
            color: var(--smart-gray);
            font-family: 'Josefin Sans', sans-serif;
            font-weight: 600;
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }
        
        .welcome-title p {
            color: var(--smart-gray-medium);
            font-size: 0.9rem;
            margin-bottom: 0;
        }

        /* Bot�n deshabilitado */
        .btn:disabled {
            opacity: .6 !important;
            cursor: not-allowed !important;
            background-color: #6c757d !important;
            border-color: #6c757d !important;
        }

            .btn:disabled:hover {
                background-color: #6c757d !important;
                border-color: #6c757d !important;
                box-shadow: 0 4px 15px rgba(108, 117, 125, 0.3) !important;
                transform: none !important;
            }

        /* SweetAlert2 bot�n rojo para errores */
        .swal2-confirm {
            background-color: #dc3545 !important;
            border: none !important;
            border-color: transparent !important;
            color: #fff !important;
            cursor: pointer !important;
            outline: none !important;
            box-shadow: none !important;
        }

            .swal2-confirm:hover {
                background-color: #c82333 !important;
                border: none !important;
                border-color: transparent !important;
                cursor: pointer !important;
                outline: none !important;
                box-shadow: none !important;
            }

            .swal2-confirm:focus {
                background-color: #dc3545 !important;
                border: none !important;
                border-color: transparent !important;
                cursor: pointer !important;
                outline: none !important;
                box-shadow: none !important;
            }

            .swal2-confirm:active {
                background-color: #c82333 !important;
                border: none !important;
                border-color: transparent !important;
                cursor: pointer !important;
                outline: none !important;
                box-shadow: none !important;
            }

        /* Estilos para SweetAlert2 overlay - asegurar que aparezca encima */
        .swal2-container {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            z-index: 99999 !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            background-color: rgba(0, 0, 0, 0.4) !important;
        }

        .swal2-popup {
            position: relative !important;
            z-index: 100000 !important;
            margin: 0 !important;
            max-width: 450px !important;
            width: 400px !important;
            padding: 1.5rem !important;
        }

        .swal2-backdrop {
            background-color: rgba(0, 0, 0, 0.4) !important;
        }

        /* Permitir que el body siga scrollable y no bloquee la pestaña */
        body.swal2-shown,
        html.swal2-shown {
            overflow: auto !important;
            position: static !important;
            width: auto !important;
            height: auto !important;
        }
        
        /* Ocultar completamente el botón de cerrar */
        .swal2-close {
            display: none !important;
        }
        
        /* Asegurar que clic fuera funcione */
        .swal2-backdrop-show {
            cursor: pointer !important;
        }
        
        /* Asegurar que el modal pueda cerrarse */
        .swal2-popup {
            pointer-events: auto !important;
        }
        
        .swal2-container {
            pointer-events: auto !important;
        }
        
        .swal2-container .swal2-popup {
            pointer-events: auto !important;
        }
        
        /* Hacer el modal más compacto y estético */
        .swal2-popup .swal2-title {
            font-size: 1.3rem !important;
            line-height: 1.4 !important;
            margin-bottom: 0.8rem !important;
        }
        
        .swal2-popup .swal2-content {
            font-size: 0.95rem !important;
            line-height: 1.5 !important;
            margin-top: 0.5rem !important;
            margin-bottom: 1rem !important;
        }
        
        .swal2-popup .swal2-actions {
            margin-top: 1rem !important;
        }
        
        .swal2-popup .swal2-confirm {
            font-size: 0.95rem !important;
            padding: 0.6rem 1.5rem !important;
        }
        
        .swal2-popup .swal2-icon {
            width: 4rem !important;
            height: 4rem !important;
            margin: 0.5rem auto 1rem auto !important;
            border: none !important;
            background: transparent !important;
        }
        
        .swal2-popup .swal2-icon .swal2-icon-content {
            font-size: 3rem !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
        }
        
        /* Estilos para iconos personalizados con Font Awesome */
        .swal2-icon i.fas {
            margin: 0 !important;
            display: block !important;
        }

        /* Prevenir que SweetAlert2 mueva la p�gina */
        .swal2-container {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            z-index: 99999 !important;
            margin: 0 !important;
            padding: 0 !important;
        }

        /* Asegurar que el popup no cause scroll */
        .swal2-popup {
            position: relative !important;
            z-index: 100000 !important;
            margin: 0 !important;
            transform: none !important;
        }

        /* Cursor pointer para botones de SweetAlert2 - m�s espec�fico */
        .swal2-actions button,
        .swal2-actions .swal2-confirm,
        .swal2-actions .swal2-cancel,
        .swal2-popup .swal2-actions button,
        .swal2-popup .swal2-actions .swal2-confirm {
            cursor: pointer !important;
        }

        /* Forzar cursor pointer en todos los elementos del popup */
        .swal2-popup * {
            cursor: default !important;
        }

        .swal2-popup button,
        .swal2-popup .swal2-confirm,
        .swal2-popup .swal2-actions button {
            cursor: pointer !important;
        }

        /* Estilo global para asegurar cursor pointer */
        .swal2-confirm:hover {
            cursor: pointer !important;
        }

        /* Forzar cursor pointer con mayor especificidad */
        .swal2-container .swal2-popup .swal2-actions .swal2-confirm {
            cursor: pointer !important;
        }

        /* Clases personalizadas para SweetAlert2 */
        .swal2-container-custom {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            z-index: 99999 !important;
            background-color: rgba(0, 0, 0, 0.4) !important;
        }

        .swal2-popup-custom {
            position: relative !important;
            z-index: 100000 !important;
            margin: 0 !important;
        }

        /* Mejoras para checkbox */
        .custom-control-input:checked ~ .custom-control-label::before {
            background-color: var(--smart-primary) !important;
            border-color: var(--smart-primary) !important;
        }
        
        .custom-control-input:focus ~ .custom-control-label::before {
            box-shadow: 0 0 0 0.2rem rgba(243, 73, 73, 0.25);
        }
        
        .custom-control-label {
            cursor: pointer;
            user-select: none;
        }

        @media (max-width: 768px) {
            body {
                padding: 20px;
            }
            
            .user_card {
                width: 100%;
                max-width: 100%;
                border-radius: 12px;
                box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
                padding: 25px;
                padding-top: 110px;
            }
            
            .brand_logo_container {
                height: 160px;
                width: 160px;
                top: -80px;
            }
            
            .brand_logo_container .login-logo {
                font-size: 3rem;
            }
            
            .welcome-title h4 {
                font-size: 1.3rem;
            }
            
            .d-flex.justify-content-center.h-100 {
                height: 100vh;
                align-items: center;
            }
        }
        
        /* Estilos mejorados para inputs */
        .input-group-text {
            background: var(--smart-primary) !important;
            color: white !important;
            border: none !important;
            border-radius: 8px 0 0 8px !important;
            padding: 0.75rem 1rem;
            transition: all 0.3s ease;
        }
        
        .form-control {
            border: 1px solid #dee2e6;
            border-left: none;
            border-radius: 0 8px 8px 0 !important;
            padding: 0.75rem 1rem;
            font-size: 0.95rem;
            transition: all 0.3s ease;
        }
        
        .form-control:focus {
            border-color: var(--smart-primary);
            box-shadow: 0 0 0 0.2rem rgba(243, 73, 73, 0.15);
            outline: none;
        }
        
        .input-group:hover .input-group-text {
            background: var(--smart-primary-dark) !important;
        }
        
        .input-group:hover .form-control {
            border-color: var(--smart-primary-light);
        }

        /* Botón de login mejorado */
        .login_btn {
            background: linear-gradient(135deg, var(--smart-primary) 0%, var(--smart-primary-dark) 100%) !important;
            color: white !important;
            border: none !important;
            box-shadow: 0 4px 15px rgba(243, 73, 73, 0.3);
            transition: all 0.3s ease;
        }
        
        .login_btn:hover:not(:disabled) {
            background: linear-gradient(135deg, var(--smart-primary-dark) 0%, var(--smart-primary-darker) 100%) !important;
            box-shadow: 0 6px 20px rgba(243, 73, 73, 0.4);
        }
        
        .login_btn:active:not(:disabled) {
            box-shadow: 0 2px 10px rgba(243, 73, 73, 0.3);
        }
        
        .login_btn:focus {
            box-shadow: 0 0 0 0.2rem rgba(243, 73, 73, 0.5) !important;
            outline: none !important;
        }
        
        /* Loading spinner - sutil y apropiado */
        .se-pre-con {
            position: fixed;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            z-index: 9999;
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(2px);
            display: flex !important;
            align-items: center;
            justify-content: center;
            transition: opacity 0.3s ease-in-out;
        }
        
        /* Ocultar cuando isLoading sea false */
        .se-pre-con[ng-hide] {
            display: none !important;
        }

        /* Spinner circular sutil con color de la aplicación */
        .se-pre-con::before {
            content: '';
            width: 50px;
            height: 50px;
            border: 4px solid rgba(243, 73, 73, 0.2);
            border-top-color: var(--smart-primary);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            box-shadow: 0 2px 10px rgba(243, 73, 73, 0.15);
        }

        /* Texto opcional "Cargando..." debajo del spinner */
        .se-pre-con::after {
            content: 'Cargando...';
            position: absolute;
            top: calc(50% + 40px);
            color: var(--smart-gray);
            font-size: 14px;
            font-family: 'Open Sans', sans-serif;
            font-weight: 400;
            letter-spacing: 0.5px;
        }

        /* Animación de rotación suave */
        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body ng-controller="Login">
    <!-- Loading spinner -->
    <div ng-hide="!isLoading" class="se-pre-con"></div>
    
    <div class="container" style="padding-top: 0;">
        <div class="d-flex justify-content-center h-100" style="min-height: 100vh; align-items: center;">
            <div class="user_card">

                <div class="d-flex justify-content-center">
                    <div class="brand_logo_container">
                        <i class="login-logo fas fa-utensils"></i>
                        <h5 class="text-white mt-2" style="color: white !important;">Smart Lunch</h5>
                    </div>
                </div>

                <div class="d-flex justify-content-center form_container">
                    <!-- Importante: ng-submit para Enter y evitar reload -->
                    <form ng-submit="logIn($event)" novalidate>
                        <!-- mensaje de error en la UI -->
                        <span id="error-msg" class="error-msg" ng-show="showError">{{ errorMsg }}</span>

                        <!-- Título de bienvenida -->
                        <div class="welcome-title">
                            <h4>Bienvenido</h4>
                            <p>Ingresa tus credenciales para continuar</p>
                        </div>
                        
                        <div class="input-group mb-3">
                            <div class="input-group-append">
                                <span class="input-group-text"><i class="fas fa-user"></i></span>
                            </div>
                            <input type="text"
                                   id="view_username"
                                   ng-model="view_username"
                                   class="form-control input_user"
                                   placeholder="Nombre de usuario"
                                   autocomplete="username"
                                   required
                                   ng-trim="true"
                                   style="border-left: none; padding-left: 0.75rem;" />
                        </div>

                        <div class="input-group mb-3">
                            <div class="input-group-append">
                                <span class="input-group-text"><i class="fas fa-key"></i></span>
                            </div>
                            <input type="password"
                                   id="view_password"
                                   ng-model="view_password"
                                   class="form-control input_pass"
                                   placeholder="Contraseña"
                                   autocomplete="current-password"
                                   required
                                   ng-trim="true"
                                   style="border-left: none; padding-left: 0.75rem;" />
                        </div>

                        <div class="form-group mb-4">
                            <div class="custom-control custom-checkbox">
                                <input type="checkbox" class="custom-control-input" id="customControlInline" />
                                <label class="custom-control-label" for="customControlInline" style="color: var(--smart-gray); font-size: 0.9rem;">Recordar sesión</label>
                            </div>
                        </div>

                        <div class="d-flex justify-content-center mt-4 login_container">
                            <button type="submit" class="btn login_btn" ng-disabled="!isFormValid()" style="padding: 0.75rem 2rem; font-size: 1rem; font-weight: 600; letter-spacing: 0.5px; border-radius: 8px; transition: all 0.3s ease;">
                                Ingresar <i class="fas fa-arrow-right ml-2"></i>
                            </button>
                        </div>
                        
                        <!-- Línea decorativa -->
                        <div class="text-center mt-4 mb-3" style="position: relative;">
                            <hr style="border: none; border-top: 1px solid #e9ecef; margin: 0;">
                            <span style="position: absolute; top: -10px; left: 50%; transform: translateX(-50%); background: #ffffff; padding: 0 15px; color: var(--smart-gray-medium); font-size: 0.85rem;">
                                <i class="fas fa-shield-alt mr-1"></i> Acceso seguro
                            </span>
                        </div>
                    </form>
                </div>

            </div>
        </div>
    </div>

    <!-- JS -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"></script>
    <script src="js/angular.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.all.min.js"></script>

    
    
    <!-- Configuración centralizada -->
    <script src="js/config.js"></script>
    
    <!-- Servicio de bloqueo de usuarios -->
    <script src="js/bloqueo-usuarios-service.js"></script>

    <!-- Tu l�gica de login (usa ng-submit y muestra errores) -->
    <script src="js/login.js"></script>
</body>
</html>
